<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Annotated slides 2020/21 edition #  Slides as annotated during the live lectures. Recordings of the live sessions are available if you&rsquo;re appropriately logged in. If you think you should have access but don&rsquo;t, please get in touch.
  Session 1, video.
  Session 2, video.
  Session 3, and the roofline paper, video part I and part II.
  Session 4, video. I got a bit confused towards the end in the exercises determining why likwid was reporting load counts different from those we were expecting."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="2020/21"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://teaching.wence.uk/comp52315/past-editions/2020-21/"><title>2020/21 | COMP52315 – Performance Engineering</title><link rel=icon href=/comp52315/favicon.svg type=image/x-icon><link rel=stylesheet href=/comp52315/book.min.0cb0b7d6a1ed5d0e95321cc15edca4d6e9cc406149d1f4a3f25fd532f6a3bb38.css integrity="sha256-DLC31qHtXQ6VMhzBXtyk1unMQGFJ0fSj8l/VMvajuzg="></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><div class=book-brand><img class=book-center src=/comp52315/logo.svg alt=Logo><h2><a href=/comp52315>COMP52315 – Performance Engineering</a></h2></div><ul><li><span>Administrivia</span><ul><li><a href=/comp52315/setup/contact/>Contact details</a></li><li><a href=/comp52315/setup/hamilton/>Hamilton accounts</a></li><li><a href=/comp52315/setup/configuration/>ssh configuration</a></li><li><a href=/comp52315/setup/unix/>Unix resources</a></li></ul></li><li><span>Exercises</span><ul><li><a href=/comp52315/exercises/exercise01/>Sum reductions</a></li><li><a href=/comp52315/exercises/exercise02/>Caches</a></li><li><a href=/comp52315/exercises/exercise03/>Memory bandwidth</a></li><li><a href=/comp52315/exercises/exercise04/>Roofline analysis</a></li><li><a href=/comp52315/exercises/exercise05/>Models and measurements</a></li><li><a href=/comp52315/exercises/exercise06/>Profiling</a></li><li><a href=/comp52315/exercises/exercise07/>Loop tiling matrix transpose</a></li><li><a href=/comp52315/exercises/exercise08/>Loop tiling matrix-matrix multiplication</a></li><li><a href=/comp52315/exercises/exercise09/>Compiler feedback and the BLIS DGEMM</a></li><li><a href=/comp52315/exercises/exercise10/>Stencil layer conditions</a></li></ul></li><li><span>Notes</span><ul><li><a href=/comp52315/notes/introduction/>Introduction</a></li><li><a href=/comp52315/notes/memory/>The memory hierarchy</a></li><li><a href=/comp52315/notes/roofline/>Performance models: roofline</a></li><li><a href=/comp52315/notes/measurements/>Measurement and profiling</a></li><li><a href=/comp52315/notes/tiling/>Cache blocking/tiling</a></li></ul></li><li><a href=/comp52315/slides/>Slides</a></li><li><a href=/comp52315/coursework/>Coursework: fast finite elements</a><ul></ul></li><li><a href=/comp52315/resources/>Further resources</a></li><li><a href=/comp52315/acknowledgements/>Acknowledgements</a></li><li><span>Past editions</span><ul><li><a href=/comp52315/past-editions/2020-21/ class=active>2020/21</a><ul></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/comp52315/svg/menu.svg class=book-icon alt=Menu></label>
<strong>2020/21</strong>
<label for=toc-control><img src=/comp52315/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#annotated-slides-202021-edition>Annotated slides 2020/21 edition</a></li></ul></nav></aside></header><article class=markdown><blockquote class="book-hint warning"><span>This course page was updated until March 2022 when I left Durham University.
The materials herein are therefore not necessarily still in date.</span></blockquote><h1 id=annotated-slides-202021-edition>Annotated slides 2020/21 edition
<a class=anchor href=#annotated-slides-202021-edition>#</a></h1><p>Slides as annotated during the live lectures. Recordings of the live
sessions are available if you&rsquo;re appropriately logged in. If you think
you should have access but don&rsquo;t, please <a href=mailto:lawrence.mitchell@durham.ac.uk>get in
touch</a>.</p><ul><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/01.pdf>Session 1</a>, <a href=https://web.microsoftstream.com/video/47a15875-eddc-48b3-ac17-6b68ee46a8d6>video</a>.</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/02.pdf>Session 2</a>, <a href=https://web.microsoftstream.com/video/ecf53b07-636e-4ffa-abe8-fe697230d56c>video</a>.</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/03.pdf>Session 3</a>, and the <a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/williams2009-roofline.pdf>roofline
paper</a>,
<a href=https://web.microsoftstream.com/video/ba7827a0-3146-4396-afde-b51082729f8c>video part I</a>
and <a href=https://web.microsoftstream.com/video/7c448687-e366-4492-8434-d0e98b5f556d>part II</a>.</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/04.pdf>Session 4</a>, <a href=https://web.microsoftstream.com/video/7c448687-e366-4492-8434-d0e98b5f556d>video</a>.
I got a bit confused towards the end in the exercises determining
why likwid was reporting load counts different from those we were
expecting. We worked this out (thanks Finlay) by the next session:
the compiler was inlining some code and producing some extra moves.</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/05.pdf>Session 5</a>, <a href=https://web.microsoftstream.com/video/86b11649-7c68-4739-a3e9-4727ee9d0621>video</a>.</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/06.pdf>Session 6</a>, <a href=https://web.microsoftstream.com/video/61b6b896-af83-4a6f-b7b0-0d7f968cf789>video</a>.
I went over the end of the cache blocking for matrix-matrix
multiplication again, and then we looked briefly at the performance
we obtained on Hamilton. We then looked at how we can convince our
compiler to generate the code we know is right. As mentioned, in my
experience, of Intel, GCC, and Clang, the Intel compiler is the best
in terms of optimisation reports. Flags for Intel are in the slides.
For GCC, we can get some reports with <code>-fopt-info</code> (see <a href=https://gcc.gnu.org/onlinedocs/gcc/Developer-Options.html>this
page</a> and
search for <code>-fopt-info</code>). For Clang, we can get some reports with
<code>-Rpass=vec</code> and <code>-Rpass-missed=vec</code> (see <a href=https://clang.llvm.org/docs/UsersManual.html#options-to-emit-optimization-reports>this
page</a>).</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/07.pdf>Session 7</a>, I also annotated one page from
the <a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/vanzee2015-blis.pdf>BLIS paper</a>, <a href=https://web.microsoftstream.com/video/994cf8c0-6403-48a0-85fd-b0d6cec9bc62>video</a>.</p><p>The two articles I took examples from for the dimension-lifted
transposition approach are <a href=https://web.cs.ucla.edu/~pouchet/doc/cc-article.11.pdf>Henretty et al. (2011), <em>Data Layout
Transformation for Stencil Computations on Short-Vector SIMD
Architectures</em></a>,
and <a href=https://arxiv.org/pdf/1512.03487.pdf>Boyle et al. (2015), <em>Grid: A next generation data parallel C++
QCD library</em></a>. One example of
the same approach applied to unstructured problems is shown in <a href=https://arxiv.org/pdf/1903.08243.pdf>Sun
et al. (2020), <em>A study of vectorization for matrix-free finite
element methods</em></a>.</p></li><li><p><a href=https://teaching.wence.uk/comp52315/lecture-slides/2020-21/08.pdf>Session 8</a>,
<a href=https://web.microsoftstream.com/video/1bc1a757-9a7a-4b08-b88b-5ef523819a0c>video</a></p><p>We did a walkthrough of doing a roofline analysis. I got a bit
confused with the data in the plots from the slides, so we did it
live with the BLIS GEMM implementation (see <a href=https://teaching.wence.uk/comp52315/exercises/exercise09/>exercise 9</a>). Those are the drawn-in points in the
annotated slides.</p><p>I then looked at application of some of the ideas in the course to
the <a href=https://www.firedrakeproject.org/>Firedrake</a> finite element
system. We did the dimension-lifted transposition approach on
unstructured data (rather than the structured grids that we looked
at last time).</p><p>Finally we tried to build the coursework code to check that it will
work when you do it. Only to find it didn&rsquo;t, so I updated the PETSc
install on Hamilton and rebuilt things, so I hope that the same
approach should work for you. Please get in touch if it doesn&rsquo;t (or
there are things that you don&rsquo;t understand).</p></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/wenceorg/comp52315/commit/cdfbd8f86c56d4a17e7e322b59a75940cea4fb4e title="Last modified by Lawrence Mitchell | April 7, 2022" target=_blank rel=noopener><img src=/comp52315/svg/calendar.svg class=book-icon alt=Calendar>
<span>April 7, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/wenceorg/comp52315/edit/main/site/content//past-editions/2020-21/_index.md target=_blank rel=noopener><img src=/comp52315/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap align-right"><p>© 2020&ndash; <a href=mailto:lawrence.mitchell@durham.ac.uk>Lawrence Mitchell</a> and <a href=https://www.dur.ac.uk/>Durham University</a>.</p><p><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=/comp52315/cc-by-sa.svg></a>
This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative
Commons Attribution-ShareAlike 4.0 International License</a>.</p></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#annotated-slides-202021-edition>Annotated slides 2020/21 edition</a></li></ul></nav></aside></main></body></html>